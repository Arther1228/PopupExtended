<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">

    <title>ArcGIS jsapi Advanced Popup Example</title>
    <link rel="stylesheet" href="http://js.arcgis.com/3.13/esri/css/esri.css">
    <link rel="stylesheet" href="http://js.arcgis.com/3.13/dijit/themes/claro/claro.css">
    <link href="ncam/PopupExtended.css" rel="stylesheet" />  

    <style>
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            font-family: Arial, Calibri;
        }

        #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            position: relative;
        }

    </style>


    <script>
        var dojoConfig = {
            parseOnLoad: false,
            async: true,
            tlmSiblingOfDojo: false,
            packages: [{
                name: "ncam",
                location: location.pathname.replace(/\/[^/]+$/, '') + "\/ncam"
            }]
        };
    </script>

    <script src="http://js.arcgis.com/3.13/"></script>

    <script type="text/javascript">

        var map;
        var graphics;


        require(["dojo/_base/lang", "dojo/dom", "dojo/dom-construct", "esri/map", "esri/layers/graphics", "esri/layers/FeatureLayer", "esri/graphic", "esri/geometry/Point", "esri/InfoTemplate", "esri/dijit/PopupTemplate",
               "esri/symbols/SimpleMarkerSymbol", "esri/symbols/SimpleLineSymbol", "esri/dijit/Popup", "esri/dijit/PopupMobile", "ncam/PopupExtended", "dojo/ready"],
        function (lang, dom, domConstruct, Map, GraphicsLayer, FeatureLayer, Graphic, Point, InfoTemplate, PopupTemplate, SimpleMarkerSymbol, SimpleLineSymbol, Popup, PopupMobile, PopupExtended, ready) {

            ready(function () {


                map = new Map("map", {
                    center: [133, -25],
                    zoom: 4,
                    basemap: "gray",
                    minZoom: 3
                });


                map.on("load", function () {

                    //add world cities feature layer from arcgis online. Create a popup template for it. No extended object on this template so it will 
                    //use the actions, theme and scaleSelected properties defined in the constructor of PopupExtended if they are defined.
                    var flTemplate = new PopupTemplate({
                        title: "{CITY_NAME}",
                        fieldInfos: [
                            { fieldName: "CNTRY_NAME", label: "Country", visible: true },
                            { fieldName: "POP_CLASS", label: "Population Class", visible: true },
                        ]
                    });

                    var flUrl = "http://sampleserver6.arcgisonline.com/arcgis/rest/services/WorldTimeZones/MapServer/0";
                    var fl = new FeatureLayer(flUrl, {
                        id: "world-cities",
                        infoTemplate: flTemplate,
                        outFields: "*"
                    });
                    map.addLayer(fl);


                    //Create an extended Popup.
                    //The exteneded object contains the custom properties applicable only to PopupExtended. Any other normal popup properties can be defined as per normal (not included in the extended object though).
                    var extendedPopup = new PopupExtended({
                        extended: {
                            defaultWidth: 250,
                            hideOnOffClick: false,
                            multiple: true,
                            smallStyleWidthBreak: 768,
                        },
                        highlight: false,
                        //titleInBody: false,
                    }, dojo.create("div"));
                    
                    //set the map to use the exteneded popup
                    extendedPopup.setMap(map); 

                    map.infoWindow = extendedPopup;

                });
            });
        });


    </script>


</head>
<body>

    <div id="map">


    </div>

</body>
</html>
